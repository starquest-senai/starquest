<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>STARQUEST</title>

    <link rel="stylesheet" type="text/css" href="css/perguntas.css"/>
    <link rel="stylesheet" type="text/css" href="_css/index.css"/>
    <link rel="stylesheet" type="text/css" href="_css/pagina_inicial.css"/>


    <script src="js/phaser.min.js"></script>
    <script src="js/perguntas.js"></script>

    <style type="text/css">
        body {
            margin: 15px ;
        }
		canvas {
			margin: auto auto ;
		}
    </style>
</head>
<body>
    <header id="cabecalho_jogo">
        <div id="logo">
            <p id="bemvindo">Seja bem-vindo, _______________!</p>
        </div>
    </header>


        <div id="perguntas">
            <h1 id="questao"></h1>
            <h2 id="resposta_questao"></h2>
            <!-- <button onclick="manda_pergunta(0)">inicia</button> -->
        </div>


        <input type="image" name="submit" id="submeter" class="Submeter2" src="img/play_256x256.png" alt="iniciar_jogo" onclick="ocultar(), despausar(),myTimer()"/>

    <!-- PROGRAMAÇÃO DO JOGO -->
    <script type="text/javascript">
    var game = new Phaser.Game(800, 600, Phaser.CANVAS, 'phaser-example', { preload: preload, create: create, update: update, render: render });

    function preload() {

        game.load.image('bullet', 'img/tiro.png');
        game.load.image('ship', 'img/nave.png');
        game.load.image('asteroidemedioA','img/AsteroideG_A_70x80.png');
        game.load.image('asteroidemedioB','img/AsteroideG_B_70x80.png');
        game.load.image('asteroidemedioC','img/AsteroideG_C_70x80.png');

    }

    var group;
    var ship;
    var weapon;
    var cursors;
    var fireButton;
    var scoreText;
    var nivelText;
    var score = 0;
    var disabledWeapon=false;
    var tempoText;
    var myArray = ['A', 'B', 'C'];

	
	
    function create() {
		
		//Jogo inicia pausado
		game.paused = true;

		//Definindo tempo para a funcao aparecer		
		
        game.physics.startSystem(Phaser.Physics.ARCADE);

        // -----------Cria asteroides		
	
        group = game.add.physicsGroup(Phaser.Physics.ARCADE);		
        criarGrupo(6);		
        game.physics.arcade.enable(group);
		

        // -----------Cria nave
        ship = this.add.sprite(400, 300, 'ship');
        ship.anchor.set(0.5);
        game.physics.arcade.enable(ship);
        ship.body.collideWorldBounds = false;
        ship.body.drag.set(70);
        ship.body.maxVelocity.set(150);

        // -----------Cria balas
        weapon = game.add.weapon(10,'bullet');

        //  Determina o tipo de bala        
        weapon._bulletKillType = Phaser.Weapon.KILL_WORLD_BOUNDS;

        //  Determina a velocidade da bala
        weapon.bulletSpeed = 300;

        //  Determina a frequencia de tiros
        weapon.fireRate = 100;

        //  Determina que a nave ira disparar as balas
        weapon.trackSprite(ship, 0, 0, true);


        // Textos
        scoreText = this.add.text(600,550, 'SCORE: 0', { fontSize: '30px', fill: '#FFF' });
        nivelText = this.add.text(620,500, 'FASE 1', { fontSize: '30px', fill: '#FFF' });
        tempoText = this.add.text(500,10, 'Tempo restante:' + counter , { fontSize: '20px', fill: '#FFF' });

        cursors = this.input.keyboard.createCursorKeys();

        fireButton = this.input.keyboard.addKey(Phaser.KeyCode.SPACEBAR);		
		
    }

    function criarGrupo(qtd){


        for (var i = 0; i < qtd; i++)
        {
            var c;
            var rand = myArray[Math.floor(Math.random() * myArray.length)];

                c = group.create(game.world.randomX, game.world.randomY, 'asteroidemedio'+rand);
                c.data.nome = rand;

            c.name = 'ast' + i;
            c.body.bounce.set(1);
            c.body.collideWorldBounds = false;
            c.body.velocity.setTo(70, 90);

        }

    }
	
	
    function colidiu(shipP, asteroideP){
        shipP.exists=false;
        disabledWeapon = true;
        //Desabilitar balas
        //weapon.bullets.killAll();

    }

    function destruiu(bulletsP,asteroideP) {
        bulletsP.kill();
        asteroideP.kill();

        if (arrayPerguntas[0].resposta == asteroideP.data.nome)
            score += 1;
        else
            score += 1;
        scoreText.setText('SCORE: ' + score);

        setTimeout(aparecer, 3000);

        //Diz quantos asteroides aparecem cada vez
        function aparecer() {
            criarGrupo(1);
        }
    }

    function update() {

        game.physics.arcade.collide(ship, group, colidiu);

        game.physics.arcade.overlap(weapon.bullets, group, destruiu, null, this);

        if (cursors.up.isDown)
        {
            game.physics.arcade.accelerationFromRotation(ship.rotation, 300, ship.body.acceleration);
        }
        else
        {
            ship.body.acceleration.set(0);
        }

        if (cursors.left.isDown)
        {
            ship.body.angularVelocity = -500;

        }
        else if (cursors.right.isDown)
        {
            ship.body.angularVelocity = 500;
        }
        else
        {
            ship.body.angularVelocity = 0;
        }

        if (fireButton.isDown && !disabledWeapon)
        {
            weapon.fire();

        }

        nivelText.setText;
        game.world.wrap(ship, 16);
		
        for(var i=0;i<group.length;i++){
		
            game.world.wrap(group.children[i], 60);
			
        }        
    }
	
    //contador de tempo restante
    var counter = 15;
	
    function myTimer() {
        var timer = setTimeout( function() {
		
		if(game.paused==false){
            counter--;
            if( counter > 0 ) {
                myTimer();				
            }
            else if(counter == 0)
            {
                game.paused = true;				
                //logica para quando acabar o tempo
            }		
		}
        }, 1000 );			
    }
	
	function pause(){	
		clearTimeout(timer);	
	}

    function render() {
        tempoText.setText("Tempo restante: " + counter +  " Segundos");       
    }
    
    function pausarJogo() {       
        game.paused = true;	       			
    }
	
	function retomarJogo() {
		game.paused = false;	
	}		 

    </script>

    <section id="botao_voltar_jogo">
        <a href="" class="button orange shield glossy" style="padding-left: 1em; padding-right: 1em; margin: -7.5% 0% 3% 10%"><img src="_img/botao_voltar_30x34.png"></a>
        <img id="pausajogo" src="_img/pause-icon_512x512.png" onclick="pausarJogo(),pause()">
		<img id="playjogo" src="_img/play-icon_342x342.png" onclick="retomarJogo(),myTimer()">
    </section>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
</body>
</html>